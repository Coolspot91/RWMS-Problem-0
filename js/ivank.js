function Point(a,b){this.x=a|0;
this.y=b|0}function Rectangle(a,b,c,d){this.x=a;this.y=b;
this.width=c;
this.height=d}function EventDispatcher(){this.lsrs={};
this.cals={}}function Event(a,b){if(!b)b=false;this.type=a;
this.target=null;
this.currentTarget=null;
this.bubbles=b}function MouseEvent(a,b){Event.call(this,a,b)}function KeyboardEvent(a,b){Event.call(this,a,b);
this.altKey=false;this.ctrlKey=false;
this.shiftKey=false;this.keyCode=0;
this.charCode=0}function DisplayObject(){EventDispatcher.call(this);
this.x=0;this.y=0;
this.scaleX=1;
this.scaleY=1;
this.rotation=0;
this.alpha=1;
this.mouseX=0;
this.mouseY=0;
this.visible=true;this.parent=null;
this.stage=null;
this._brect=new Rectangle(0,0,0,0);
this._tmat=mat3.create();
this._imat=mat3.create();
this._temp=new Float32Array(2);
this._atsEv=new Event(Event.ADDED_TO_STAGE);
this._rfsEv=new Event(Event.REMOVED_FROM_STAGE);
this._atsEv.target=this._rfsEv.target=this;
this._tmat[8]=this._imat[8]=1}function InteractiveObject(){DisplayObject.call(this);
this.buttonMode=false;
this.mouseEnabled=true}function DisplayObjectContainer(){InteractiveObject.call(this);
this.numChildren=0;
this.mouseChildren=true;this._children=[];
this._brect2=new Rectangle(0,0,0,0)}function BitmapData(a){this.width=0;
this.height=0;this.rect=null;this.loader=new EventDispatcher;
this._texture=gl.createTexture();this._rwidth=0;
this._rheight=0;this._tcBuffer=gl.createBuffer();
this._vBuffer=gl.createBuffer();this._loaded=false;
this._ldEv=new Event(Event.COMPLETE);this._ldEv.target=this.loader;
this._tcB={};this._vxB={};if(a==null)return;var b=new Image;var c=this;
b.onload=function(a){c._initFromImg(b,b.width,b.height);c.loader.dispatchEvent(c._ldEv)};b.src=a}function Bitmap(a){DisplayObject.call(this);
this.bitmapData=a}function MBitmap(a,b,c){if(!b)b=1;if(!c)c=1;Bitmap.call(this,a);this.currentFrame=0;this.totalFrames=b*c;this._rs=b;this._cs=c;
this._tcB=null;this._vxB=null}function Stage(a){DisplayObjectContainer.call(this);document.body.style.margin="0";this.stage=this;this.stageWidth=0;
this.stageHeight=0;this.focus=null;this._mfocus=null;this._useHand=false;this._mstack=new MStack;this._sprg=null;this._umat=mat3.create([2,0,1,0,-2,0,-1,1,1]);
this._smat=mat3.create([1/100,0,1,0,1/100,0,0,0,1]);this._efEv=new Event(Event.ENTER_FRAME);this._rsEv=new Event(Event.RESIZE);this._mclEv=new MouseEvent(MouseEvent.CLICK,true);
this._mdoEv=new MouseEvent(MouseEvent.MOUSE_DOWN,true);this._mupEv=new MouseEvent(MouseEvent.MOUSE_UP,true);
this._mmoEv=new MouseEvent(MouseEvent.MOUSE_MOVE,true);this._movEv=new MouseEvent(MouseEvent.MOUSE_OVER,true);
this._mouEv=new MouseEvent(MouseEvent.MOUSE_OUT,true);this._kdEv=new KeyboardEvent(KeyboardEvent.KEY_DOWN,true);
this._kuEv=new KeyboardEvent(KeyboardEvent.KEY_UP,true);
this._smd=false;this._smu=false;this._smm=false;this._srs=false;
this._canvas=this.canvas=document.getElementById(a);
Stage._main=this;var b={antialias:true,stencil:false,depth:false};
var c=this.canvas;gl=c.getContext("webgl",b);if(!gl)gl=c.getContext("experimental-webgl",b);
if(!gl)alert("Could not initialize WebGL. Try to update your browser or graphic drivers.");
c.addEventListener("mousedown",Stage._onMD,false);c.addEventListener("mousemove",Stage._onMM,false);
c.addEventListener("mouseup",Stage._onMU,false);document.addEventListener("keydown",Stage._onKD,false);
document.addEventListener("keyup",Stage._onKU,false);document.addEventListener("keydown",Stage._blck,false);
document.addEventListener("keydup",Stage._blck,false);c.addEventListener("touchstart",Stage._onMD,false);
c.addEventListener("touchmove",Stage._onMM,false);c.addEventListener("touchend",Stage._onMU,false);
c.addEventListener("touchstart",Stage._blck,false);c.addEventListener("touchmove",Stage._blck,false);
c.addEventListener("touchend",Stage._blck,false);window.addEventListener("resize",Stage._onRS,false);
this._initShaders();this._initBuffers();gl.clearColor(0,0,0,0);gl.blendFuncSeparate(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA,gl.ONE,gl.ONE_MINUS_SRC_ALPHA);gl.enable(gl.BLEND);this._resize();Stage._tick()}function MStack(){this.mats=[];this.size=0;for(var a=0;a<30;a++)this.mats.push(mat3.create())}function Graphics(){this._px=0;this._py=0;this._lns=[];this._cvs=[];this._tgs=[];this._elems=[];this._dlns=[];this._dcvs=[];this._dtgs={};this._minx=Number.POSITIVE_INFINITY;this._miny=this._minx;this._maxx=Number.NEGATIVE_INFINITY;this._maxy=this._maxx;this._brect=new Rectangle(0,0,0,0);this._clstyle=new LineStyle(1,0,1);this._cfstyle=new FillStyle(16711680,1);this._bdata=null;this._ftype=0;this._empty=true}function USegment(a,b){this.n=a;this.vbuf=gl.createBuffer();this.points=new Float32Array(4*a);this.color=new Float32Array(4);gl.bindBuffer(gl.ARRAY_BUFFER,this.vbuf);gl.bufferData(gl.ARRAY_BUFFER,this.points,gl.STATIC_DRAW);this.updateData(b)}function UTgs(a,b,c,d,e,f){this.key=a.length+"-"+b.length;this.vrt=a;this.ind=b;this.uvt=c;this.useTex=d;this.color=new Float32Array([0,0,0,0]);this._bdata=f;if(!d)this.SetColor(e);this.vbuf=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,this.vbuf);gl.bufferData(gl.ARRAY_BUFFER,a,gl.STATIC_DRAW);this.ibuf=gl.createBuffer();gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.ibuf);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,b,gl.STATIC_DRAW);this.tbuf=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,this.tbuf);gl.bufferData(gl.ARRAY_BUFFER,c,gl.STATIC_DRAW)}function FillStyle(a,b){this.color=new Float32Array([0,0,0,0]);this.Set(a,b)}function LineStyle(a,b,c){this.Set(a,b,c)}function Sprite(){DisplayObjectContainer.call(this);this.graphics=new Graphics}function TextFormat(a,b,c,d,e,f,g){this.font=a?a:"Times new Roman";this.size=b?b:12;this.color=c?c:0;this.bold=d?d:false;this.italic=e?e:false;this.align=f?f:"left";this.leading=g?g:0;this.maxW=0;this.data={image:null,tw:0,th:0}}function TextField(){InteractiveObject.call(this);this.textWidth=0;this.textHeight=0;this.wordWrap=false;this._areaW=100;this._areaH=100;this._text=null;this._tForm=new TextFormat;this._texture=gl.createTexture();this._tcArray=new Float32Array([0,0,0,0,0,0,0,0]);this._tcBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,this._tcBuffer);gl.bufferData(gl.ARRAY_BUFFER,this._tcArray,gl.STATIC_DRAW);this._fArray=new Float32Array([0,0,0,0,0,0,0,0]);this._vBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,this._vBuffer);gl.bufferData(gl.ARRAY_BUFFER,this._fArray,gl.STATIC_DRAW);this._brect.x=this._brect.y=0}function Resizable(a,b){Sprite.call(this);this.w=a;this.h=b;this.margin=30}function MainMenu(a,b){Resizable.call(this,a,b)}function LevelSelect(a,b){Resizable.call(this,a,b);this.levelData=new Object}function GameControl(a,b){Resizable.call(this,a,b);this.result={}}function Main(a,b){Resizable.call(this,a,b);this.mm;this.ls;this.gc;this.addEventListener("GoPlay",Main.GoPlay);this.addEventListener("GoBack",Main.GoBack);this.addEventListener("LevelChosen",Main.LevelChosen);this.addEventListener("GameDone",Main.GameDone);this.addEventListener("ExitGame",Main.ExitGame)}window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){window.setTimeout(a,1e3/60)}}();"use strict";mat3={};MatrixArray=Float32Array;mat3.create=function(a){var b=new MatrixArray(9);if(a)mat3.set(a,b);return b};mat3.set=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};mat3.multiply=function(a,b,c){var d=a[0],e=a[1],f=a[2],g=a[3],h=a[4],i=a[6],j=a[7],k=b[0],l=b[1],m=b[2],n=b[3],o=b[4],p=b[6],q=b[7];c[0]=k*d+l*g;c[1]=k*e+l*h;c[2]=f*m;c[3]=n*d+o*g;c[4]=n*e+o*h;c[6]=p*d+q*g+i;c[7]=p*e+q*h+j;return c};mat3.inverse=function(a,b){var c=a[0],d=a[1],e=a[3],f=a[4],g=a[6],h=a[7],i=f,j=-e,k=h*e-f*g,l=c*i+d*j,m;m=1/l;b[0]=i*m;b[1]=-d*m;b[3]=j*m;b[4]=c*m;b[6]=k*m;b[7]=(-h*c+d*g)*m};mat3.multiplyVec2=function(a,b,c){if(!c)c=b;var d=b[0],e=b[1];c[0]=d*a[0]+e*a[3]+a[6];c[1]=d*a[1]+e*a[4]+a[7]};Point.prototype.clone=function(){return new Point(this.x,this.y)};Point.prototype.setTo=function(a,b){this.x=a;this.y=b};Point.distance=function(a,b){return Point._distance(a.x,a.y,b.x,b.y)};Point._distance=function(a,b,c,d){return Math.sqrt((c-a)*(c-a)+(d-b)*(d-b))};Rectangle.prototype.containsPoint=function(a){return this.contains(a.x,a.y)};Rectangle.prototype.contains=function(a,b){return a>=this.x&&a<=this.x+this.width&&b>=this.y&&b<=this.y+this.height};Rectangle.prototype.clone=function(){return new Rectangle(this.x,this.y,this.width,this.height)};Rectangle.prototype.copyFrom=function(a){this.x=a.x;this.y=a.y;this.width=a.width;this.height=a.height};Rectangle.prototype.union=function(a){var b=this.clone();b._unionWith(a);return b};Rectangle.prototype._unionWith=function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.width=Math.max(this.x+this.width,a.x+a.width)-this.x;this.height=Math.max(this.y+this.height,a.y+a.height)-this.y};EventDispatcher.efbc=[];EventDispatcher.prototype.hasEventListener=function(a){var b=this.lsrs[a];if(b==null)return false;return b.length>0};EventDispatcher.prototype.addEventListener=function(a,b){this.addEventListener2(a,b,null)};EventDispatcher.prototype.addEventListener2=function(a,b,c){if(this.lsrs[a]==null){this.lsrs[a]=[];this.cals[a]=[]}this.lsrs[a].push(b);this.cals[a].push(c);if(a==Event.ENTER_FRAME){var d=EventDispatcher.efbc;if(d.indexOf(this)<0)d.push(this)}};EventDispatcher.prototype.removeEventListener=function(a,b){var c=this.lsrs[a];if(c==null)return;var d=c.indexOf(b);if(d<0)return;var e=this.cals[a];c.splice(d,1);e.splice(d,1);if(a==Event.ENTER_FRAME&&c.length==0){var f=EventDispatcher.efbc;f.splice(f.indexOf(this),1)}};EventDispatcher.prototype.dispatchEvent=function(a){var b=this.lsrs[a.type];if(b==null)return;var c=this.cals[a.type];for(var d=0;d<b.length;d++){a.currentTarget=this;if(a.target==null)a.target=this;if(c[d]==null)b[d](a);else b[d].call(c[d],a)}};Event.ENTER_FRAME="enterFrame";Event.RESIZE="resize";Event.COMPLETE="complete";Event.ADDED_TO_STAGE="addedToStage";Event.REMOVED_FROM_STAGE="removedFromStage";MouseEvent.prototype=new Event;MouseEvent.CLICK="click";MouseEvent.MOUSE_MOVE="mouseMove";MouseEvent.MOUSE_DOWN="mouseDown";MouseEvent.MOUSE_UP="mouseUp";MouseEvent.MOUSE_OVER="mouseOver";MouseEvent.MOUSE_OUT="mouseOut";KeyboardEvent.prototype=new Event;KeyboardEvent.prototype._setFromDom=function(a){this.altKey=a.altKey;this.ctrlKey=a.ctrlKey;this.shiftKey=a.ShiftKey;this.keyCode=a.keyCode;this.charCode=a.charCode};KeyboardEvent.KEY_DOWN="keyDown";KeyboardEvent.KEY_UP="keyUp";DisplayObject.prototype=new EventDispatcher;DisplayObject.prototype.GetWidth=function(){var a=this._getRect();return a==null?0:a.width*this.scaleX};DisplayObject.prototype.GetHeight=function(){var a=this._getRect();return a==null?0:a.height*this.scaleY};DisplayObject.prototype._setStage=function(a){var b=this.stage;this.stage=a;if(b==null&&a!=null)this.dispatchEvent(this._atsEv);if(b!=null&&a==null)this.dispatchEvent(this._rfsEv)};DisplayObject.prototype.SetWidth=function(a){var b=this.GetWidth();if(b!=0)this.scaleX*=a/b};DisplayObject.prototype.SetHeight=function(a){var b=this.GetHeight();if(b!=0)this.scaleY*=a/b};DisplayObject.prototype._getRect=function(){return this._brect};DisplayObject.prototype._moveMouse=function(a,b,c){this._setMousePos(a,b);return null};DisplayObject.prototype._setMousePos=function(a,b){var c=this._temp;c[0]=a;c[1]=b;mat3.multiplyVec2(this._imat,c);this.mouseX=c[0];this.mouseY=c[1]};DisplayObject.prototype.dispatchEvent=function(a){EventDispatcher.prototype.dispatchEvent.call(this,a);if(a.bubbles&&this.parent!=null)this.parent.dispatchEvent(a)};DisplayObject.prototype._preRender=function(a){var b=this._tmat;var c=this.scaleX;var d=this.scaleY;b[0]=b[4]=1;b[1]=b[3]=0;if(this.rotation!=0){var e=this.rotation*.0174532925;b[0]=Math.cos(e);b[1]=Math.sin(e);b[3]=-b[1];b[4]=b[0]}if(c!=1){b[0]*=c;b[1]*=c}if(d!=1){b[3]*=d;b[4]*=d}b[6]=this.x;b[7]=this.y;b[2]=0;mat3.inverse(b,this._imat);b[2]=this.alpha;a._mstack.push(b)};DisplayObject.prototype._render=function(a){};DisplayObject.prototype._renderAll=function(a){if(!this.visible)return;this._preRender(a);this._render(a);a._mstack.pop()};InteractiveObject.prototype=new DisplayObject;InteractiveObject.prototype._moveMouse=function(a,b,c){this._setMousePos(a,b);if(!c||!this.visible||!this.mouseEnabled)return null;var d=this._getRect();if(d==null)return null;if(d.contains(this.mouseX,this.mouseY))return this;return null};DisplayObjectContainer.prototype=new InteractiveObject;DisplayObjectContainer.prototype._moveMouse=function(a,b,c){this._setMousePos(a,b);var d=this.mouseX,e=this.mouseY;var f=c;if(f)if(!this.visible||!this.mouseChildren&&!this.mouseEnabled)f=false;var g=null;var h=this.numChildren-1;for(var i=h;i>-1;i--){var j=this._children[i]._moveMouse(d,e,f);if(j!=null){g=j;f=false}}if(!this.mouseChildren&&g!=null)return this;return g};DisplayObjectContainer.prototype._setStage=function(a){InteractiveObject.prototype._setStage.call(this,a);for(var b=0;b<this.numChildren;b++)this._children[b]._setStage(a)};DisplayObjectContainer.prototype._getRect=function(){if(this.numChildren==0)return null;var a=this._brect;var b=this._brect2;var c;var d;var e;for(d=0;d<this.numChildren;d++){e=this._children[d];c=e._getRect();if(c==null)continue;else{a.copyFrom(c);a.x+=e.x;a.y+=e.y;a.width*=e.scaleX;a.height*=e.scaleY;break}}if(d==this.numChildren)return null;for(d=d;d<this.numChildren;d++){e=this._children[d];c=e._getRect();if(c!=null){b.copyFrom(c);b.x+=e.x;b.y+=e.y;b.width*=e.scaleX;b.height*=e.scaleY;a._unionWith(b)}}return a};DisplayObjectContainer.prototype.addChild=function(a){this._children.push(a);a.parent=this;a._setStage(this.stage);++this.numChildren};DisplayObjectContainer.prototype.removeChild=function(a){var b=this._children.indexOf(a);this._children.splice(b,1);a.parent=null;a._setStage(null);--this.numChildren};DisplayObjectContainer.prototype.removeChildAt=function(a){this.removeChild(this._children[a])};DisplayObjectContainer.prototype.contains=function(a){return this._children.indexOf(a)>=0};DisplayObjectContainer.prototype.getChildIndex=function(a){return this._children.indexOf(a)};DisplayObjectContainer.prototype.setChildIndex=function(a,b){var c=this._children.indexOf(a);if(b>c){for(var d=c+1;d<=b;d++)this._children[d-1]=this._children[d];this._children[b]=a}else if(b<c){for(var d=c-1;d>=b;d--)this._children[d+1]=this._children[d];this._children[b]=a}};DisplayObjectContainer.prototype.getChildAt=function(a){return this._children[a]};DisplayObjectContainer.prototype._render=function(a){for(var b=0;b<this.numChildren;b++)this._children[b]._renderAll(a)};BitmapData.empty=function(a,b){var c=new BitmapData(null);c._initFromImg(null,a,b);return c};BitmapData.prototype.setPixels=function(a,b){gl.bindTexture(gl.TEXTURE_2D,this._texture);gl.texSubImage2D(gl.TEXTURE_2D,0,a.x,a.y,a.width,a.height,gl.RGBA,gl.UNSIGNED_BYTE,b);gl.generateMipmap(gl.TEXTURE_2D)};BitmapData.prototype.getPixels=function(a,b){this._setTexAsFB();gl.readPixels(a.x,a.y,a.width,a.height,gl.RGBA,gl.UNSIGNED_BYTE,b);Stage._main._setFramebuffer(null,Stage._main.stageWidth,Stage._main.stageHeight,false)};BitmapData.prototype.draw=function(a){this._setTexAsFB();a.render(Stage._main);Stage._main.setFramebuffer(null,Stage._main.stageWidth,Stage._main.stageHeight,false)};BitmapData.prototype._setTexAsFB=function(){if(BitmapData._fbo==null)BitmapData._fbo=gl.createFramebuffer();Stage._main.setFramebuffer(BitmapData._fbo,this.width,this.height,true);gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,this._texture,0)};BitmapData.prototype._initFromImg=function(a,b,c){this._loaded=true;this.width=b;this.height=c;this._rwidth=BitmapData._nhpot(b);this._rheight=BitmapData._nhpot(c);this.rect=new Rectangle(0,0,b,c);var d=b/this._rwidth;var e=c/this._rheight;gl.bindBuffer(gl.ARRAY_BUFFER,this._tcBuffer);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([0,0,d,0,0,e,d,e]),gl.STATIC_DRAW);gl.bindBuffer(gl.ARRAY_BUFFER,this._vBuffer);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([0,0,b,0,0,c,b,c]),gl.STATIC_DRAW);var f=BitmapData._canv;f.width=this._rwidth;f.height=this._rheight;var g=BitmapData._ctx;if(a!=null)g.drawImage(a,0,0);var h=g.getImageData(0,0,this._rwidth,this._rheight);gl.bindTexture(gl.TEXTURE_2D,this._texture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,h);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR_MIPMAP_NEAREST);gl.generateMipmap(gl.TEXTURE_2D)};BitmapData.prototype._getTcBuffers=function(a,b){var c=this._tcB[a+"-"+b];if(c!=null)return c;var d=this.width/this._rwidth;var e=this.height/this._rheight;var f=d/b;var g=e/a;c=[];for(var h=0;h<a;h++)for(var i=0;i<b;i++){var j=gl.createBuffer();var k=[i*f,h*g,(i+1)*f,h*g,i*f,(h+1)*g,(i+1)*f,(h+1)*g];gl.bindBuffer(gl.ARRAY_BUFFER,j);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(k),gl.STATIC_DRAW);c.push(j)}this._tcB[a+"-"+b]=c;return c};BitmapData.prototype._getVxBuffer=function(a,b){var c=this._vxB[a+"-"+b];if(c!=null)return c;var d=this.width/b;var e=this.height/a;var c=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,c);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([0,0,d,0,0,e,d,e]),gl.STATIC_DRAW);this._vxB[a+"-"+b]=c;return c};BitmapData._canv=document.createElement("canvas");BitmapData._ctx=BitmapData._canv.getContext("2d");BitmapData._ipot=function(a){return(a&a-1)==0};BitmapData._nhpot=function(a){--a;for(var b=1;b<32;b<<=1){a=a|a>>b}return a+1};Bitmap.prototype=new InteractiveObject;Bitmap.prototype._getRect=function(){return this.bitmapData.rect};Bitmap.prototype._render=function(a){if(!this.bitmapData._loaded)return;gl.uniformMatrix3fv(a._sprg.tMatUniform,false,a._mstack.top());gl.bindBuffer(gl.ARRAY_BUFFER,this.bitmapData._vBuffer);gl.vertexAttribPointer(a._sprg.vpa,2,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,this.bitmapData._tcBuffer);gl.vertexAttribPointer(a._sprg.tca,2,gl.FLOAT,false,0,0);gl.bindTexture(gl.TEXTURE_2D,this.bitmapData._texture);gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0)};MBitmap.prototype=new Bitmap;MBitmap.prototype._getRect=function(){return this._brect};MBitmap.prototype.gotoAndStop=function(a){this.currentFrame=a%this.totalFrames};MBitmap.prototype.nextFrame=function(){this.currentFrame=(this.currentFrame+1)%this.totalFrames};MBitmap.prototype.prevFrame=function(){this.currentFrame=(this.totalFrames+this.currentFrame-1)%this.totalFrames};MBitmap.prototype._render=function(a){if(this._tcB==null){var b=this.bitmapData;if(!b._loaded)return;this._tcB=b._getTcBuffers(this._rs,this._cs);this._vxB=b._getVxBuffer(this._rs,this._cs);this._brect.width=b.width/this._cs;this._brect.height=b.height/this._rs}gl.uniformMatrix3fv(a._sprg.tMatUniform,false,a._mstack.top());gl.bindBuffer(gl.ARRAY_BUFFER,this._vxB);gl.vertexAttribPointer(a._sprg.vpa,2,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,this._tcB[this.currentFrame]);gl.vertexAttribPointer(a._sprg.tca,2,gl.FLOAT,false,0,0);gl.bindTexture(gl.TEXTURE_2D,this.bitmapData._texture);gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0)};var gl;Stage.prototype=new DisplayObjectContainer;Stage._onMD=function(a){Stage._main._smd=true};Stage._onMM=function(a){Stage._main.mouseX=Stage._mouse(a,true);Stage._main.mouseY=Stage._mouse(a,false);Stage._main._smm=true};Stage._onMU=function(a){Stage._main._smu=true};Stage._onKD=function(a){var b=Stage._main;b._kdEv._setFromDom(a);if(b.focus&&b.focus.stage)b.focus.dispatchEvent(b._kdEv);else b.dispatchEvent(b._kdEv)};Stage._onKU=function(a){var b=Stage._main;b._kuEv._setFromDom(a);if(b.focus&&b.focus.stage)b.focus.dispatchEvent(b._kuEv);else b.dispatchEvent(b._kuEv)};Stage._blck=function(a){if(a.keyCode!=null)if(a.keyCode>111)return;a.preventDefault()};Stage._onRS=function(a){Stage._main._srs=true};Stage.prototype._resize=function(){var a=window.innerWidth;var b=window.innerHeight;this.stageWidth=a;this.stageHeight=b;this._canvas.width=a;this._canvas.height=b;this._setFramebuffer(null,a,b,false)};Stage.prototype._getShader=function(a,b,c){var d;if(c)d=a.createShader(a.FRAGMENT_SHADER);else d=a.createShader(a.VERTEX_SHADER);a.shaderSource(d,b);a.compileShader(d);if(!a.getShaderParameter(d,a.COMPILE_STATUS)){alert(a.getShaderInfoLog(d));return null}return d};Stage.prototype._initShaders=function(){var a="			precision mediump float;			varying vec2 texCoord;			varying float alpha;						uniform sampler2D uSampler;			uniform vec4 color;			uniform bool useTex;						void main(void) {				if(useTex)				{					gl_FragColor = texture2D(uSampler, texCoord);				}				else gl_FragColor = color;				gl_FragColor.w *= alpha;			}";var b="			attribute vec2 verPos;			attribute vec2 texPos;						uniform mat3 tMat;						varying vec2 texCoord;			varying float alpha;						void main(void) {				vec3 v = tMat * vec3(verPos, 1.0);				gl_Position = vec4(v.x, v.y, 0, 1);				texCoord = texPos;				alpha = tMat[0][2];			}";var c=this._getShader(gl,a,true);var d=this._getShader(gl,b,false);this._sprg=gl.createProgram();gl.attachShader(this._sprg,d);gl.attachShader(this._sprg,c);gl.linkProgram(this._sprg);if(!gl.getProgramParameter(this._sprg,gl.LINK_STATUS)){alert("Could not initialise shaders")}gl.useProgram(this._sprg);this._sprg.vpa=gl.getAttribLocation(this._sprg,"verPos");this._sprg.tca=gl.getAttribLocation(this._sprg,"texPos");gl.enableVertexAttribArray(this._sprg.tca);gl.enableVertexAttribArray(this._sprg.vpa);this._sprg.tMatUniform=gl.getUniformLocation(this._sprg,"tMat");this._sprg.samplerUniform=gl.getUniformLocation(this._sprg,"uSampler");this._sprg.useTex=gl.getUniformLocation(this._sprg,"useTex");this._sprg.color=gl.getUniformLocation(this._sprg,"color");gl.uniform1i(this._sprg.useTex,1)};Stage.prototype._initBuffers=function(){var a=[0,3,1,0,2,3];this._unitIBuffer=gl.createBuffer();gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this._unitIBuffer);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(a),gl.STATIC_DRAW);a=[];for(var b=0;b<100;b++)a.push(b);this._unitI33=gl.createBuffer();gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this._unitI33);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(a),gl.STATIC_DRAW);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this._unitIBuffer)};Stage.prototype._setFramebuffer=function(a,b,c,d){this._mstack.clear();if(d){this._umat[4]=2;this._umat[7]=-1}else{this._umat[4]=-2;this._umat[7]=1}this._mstack.set(this._umat,0);this._smat[0]=1/b;this._smat[4]=1/c;this._mstack.push(this._smat);gl.bindFramebuffer(gl.FRAMEBUFFER,a);gl.viewport(0,0,b,c)};Stage._mouse=function(a,b){var c=a;if(a.type=="touchstart"||a.type=="touchmove"||a.type=="touchend")c=a.touches.item(0);if(b)return c.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;else return c.clientY+document.body.scrollTop+document.documentElement.scrollTop};Stage.prototype._drawScene=function(){if(this._srs){this._resize();this.dispatchEvent(this._rsEv);this._srs=false}gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT);var a=this._moveMouse(this.mouseX,this.mouseY,true);var b=this._mfocus||this,c=a||this;if(a!=this._mfocus){if(b!=this){var d=this._mouEv;d.target=b;b.dispatchEvent(d)}if(c!=this){d=this._movEv;d.target=c;c.dispatchEvent(d)}}this._mdoEv.target=this._mupEv.target=this._mmoEv.target=this._mclEv.target=c;if(this._smd){c.dispatchEvent(this._mdoEv);this.focus=a}if(this._smu){c.dispatchEvent(this._mupEv);if(a==this.focus)c.dispatchEvent(this._mclEv)}if(this._smm)c.dispatchEvent(this._mmoEv);this._smd=this._smu=this._smm=false;this._mfocus=a;var e=false,f=c;while(f.parent!=null){e|=f.buttonMode;f=f.parent}if(e!=this._useHand)this._canvas.style.cursor=e?"pointer":"default";this._useHand=e;var g=EventDispatcher.efbc;var d=this._efEv;for(var h=0;h<g.length;h++){d.target=g[h];g[h].dispatchEvent(d)}this._renderAll(this)};Stage._tick=function(){requestAnimFrame(Stage._tick);Stage.prototype._drawScene.call(Stage._main)};MStack.prototype.clear=function(){this.size=0};MStack.prototype.set=function(a,b){mat3.set(a,this.mats[b]);this.size=b+1};MStack.prototype.push=function(a){var b=this.size++;mat3.multiply(this.mats[b-1],a,this.mats[b])};MStack.prototype.pop=function(){this.size--};MStack.prototype.top=function(){return this.mats[this.size-1]};Graphics.prototype._render=function(a){gl.uniformMatrix3fv(a._sprg.tMatUniform,false,a._mstack.top());var b=this._elems;for(var c=0;c<b.length;c++)b[c].render(a);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,a._unitIBuffer);gl.uniform1i(a._sprg.useTex,1)};Graphics.prototype.lineStyle=function(a,b,c){if(!c)c=1;this._clstyle.Set(a,b,c)};Graphics.prototype.beginFill=function(a,b){this._ftype=0;if(!b)b=1;this._cfstyle.Set(a,b)};Graphics.prototype.beginBitmapFill=function(a){this._ftype=1;this._bdata=a};Graphics.prototype.endFill=function(){};Graphics.prototype.moveTo=function(a,b){this._px=a;this._py=b};Graphics.prototype.lineTo=function(a,b){var c;if(this._dlns.length==0)c=new USegment(2,this._clstyle);else{c=this._dlns.pop()}var d=this._px,e=this._py;var f=.5*this._clstyle.thickness/this.len(d-a,e-b);var g=f*(e-b);var h=-f*(d-a);c.points[0]=d+g;c.points[1]=e+h;c.points[2]=d-g;c.points[3]=e-h;c.points[4]=a+g;c.points[5]=b+h;c.points[6]=a-g;c.points[7]=b-h;c.updateData(this._clstyle.color);this._px=a;this._py=b;this._lns.push(c);this._elems.push(c);this._empty=false};Graphics.prototype.len=function(a,b){return Math.sqrt(a*a+b*b)};Graphics.prototype.curveTo=function(a,b,c,d){var e=this._px,f=this._py,g=.6666;this.cubicCurveTo(e+g*(a-e),f+g*(b-f),c+g*(a-c),d+g*(b-d),c,d)};Graphics.prototype.cubicCurveTo=function(a,b,c,d,e,f){var g;if(this._dcvs.length==0)g=new USegment(41,this._clstyle);else{g=this._dcvs.pop()}var h=g.points;var i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F;var G=.5*this._clstyle.thickness;var H,I,J,K,L;i=this._px;j=this._py;u=a-i;v=b-j;w=c-a;x=d-b;y=e-c;z=f-d;step=1/40;for(var M=0;M<41;M++){var N=M*step;k=i+N*u;l=j+N*v;m=a+N*w;n=b+N*x;o=c+N*y;p=d+N*z;A=m-k;B=n-l;C=o-m;D=p-n;q=k+N*A;r=l+N*B;s=m+N*C;t=n+N*D;E=s-q;F=t-r;K=q+N*E;L=r+N*F;H=G/this.len(E,F);I=H*F;J=-H*E;h[4*M]=K+I;h[4*M+1]=L+J;h[4*M+2]=K-I;h[4*M+3]=L-J}g.updateData(this._clstyle.color);this._px=e;this._py=f;this._cvs.push(g);this._elems.push(g);this._empty=false};Graphics.prototype.drawCircle=function(a,b,c){var d=Math.PI/16;if(Graphics.cVrt==null){var e=Graphics.cVrt=[a,b];var f=Graphics.cInd=[];for(var g=1;g<33;g++)f.push(0,g,g%32+1);for(var g=0;g<2*Math.PI;g+=d)e.push(0,0)}var e=Graphics.cVrt;e[0]=a;e[1]=b;var h=2;for(var g=0;g<2*Math.PI;g+=d){e[h++]=a+Math.cos(g)*c;e[h++]=b+Math.sin(g)*c}this.drawTriangles(e,Graphics.cInd)};Graphics.prototype.drawRect=function(a,b,c,d){var e=Graphics.rVrt;e[0]=e[4]=a;e[1]=e[3]=b;e[2]=e[6]=a+c;e[5]=e[7]=b+d;this.drawTriangles(e,Graphics.rInd)};Graphics.prototype.drawTriangles=function(a,b,c){for(var d=0;d<a.length;d+=2)this.updateBounds(a[d],a[d+1]);var e=a.length+"-"+b.length;var f=1/256,g=1/256;if(this._ftype==1)if(this._bdata._loaded){f=1/this._bdata._rwidth;g=1/this._bdata._rheight}var h;var i=this._dtgs[e];if(i!=null&&i.length>0){h=i.pop();for(var d=0;d<a.length;d++)h.vrt[d]=a[d];for(var d=0;d<b.length;d++)h.ind[d]=b[d];if(c!=null)for(var d=0;d<c.length;d++)h.uvt[d]=c[d];else for(var d=0;d<a.length;d+=2){h.uvt[d]=f*a[d];h.uvt[d+1]=g*a[d+1]}if(this._ftype==1){h.useTex=true;h._bdata=this._bdata}else{h.useTex=false;h.SetColor(this._cfstyle.color)}h.updateData()}else{var j=new Float32Array(a);var k=new Uint16Array(b);var l;if(c!=null)l=new Float32Array(c);else{l=new Float32Array(a);for(var d=0;d<l.length;d+=2){l[d]*=f;l[d+1]*=g}}if(this._ftype==1)h=new UTgs(j,k,l,true,null,this._bdata);else h=new UTgs(j,k,l,false,this._cfstyle.color,null)}this._tgs.push(h);this._elems.push(h);this._empty=false};Graphics.prototype.clear=function(){this._dlns=this._lns;this._dcvs=this._cvs;for(var a=0;a<this._tgs.length;a++){var b=this._tgs[a];if(this._dtgs[b.key]==null)this._dtgs[b.key]=[];this._dtgs[b.key].push(b)}this._lns=[];this._cvs=[];this._tgs=[];this._elems=[];this._ftype=0;this._empty=true;this._minx=Number.POSITIVE_INFINITY;this._miny=this._minx;this._maxx=Number.NEGATIVE_INFINITY;this._maxy=this._maxx};Graphics.prototype._getRect=function(){if(this._empty)return null;var a=this._brect;a.x=this._minx;a.y=this._miny;a.width=this._maxx-a.x;a.height=this._maxy-a.y;return a};Graphics.prototype._hits=function(a,b){if(this._empty)return false;return a>=this._minx&&a<=this._maxx&&b>=this._miny&&b<=this._maxy};Graphics.prototype.updateBounds=function(a,b){a<this._minx?this._minx=a:a>this._maxx?this._maxx=a:0;b<this._miny?this._miny=b:b>this._maxy?this._maxy=b:0};Graphics.rVrt=[0,0,0,0,0,0,0,0];Graphics.rInd=[0,1,2,1,2,3];USegment.prototype.updateData=function(a){var b=this.color;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];gl.bindBuffer(gl.ARRAY_BUFFER,this.vbuf);gl.bufferSubData(gl.ARRAY_BUFFER,0,this.points)};USegment.prototype.render=function(a){gl.uniform1i(a._sprg.useTex,0);gl.uniform4fv(a._sprg.color,this.color);gl.bindBuffer(gl.ARRAY_BUFFER,this.vbuf);gl.vertexAttribPointer(a._sprg.vpa,2,gl.FLOAT,false,0,0);gl.vertexAttribPointer(a._sprg.tca,2,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,a._unitI33);gl.drawElements(gl.TRIANGLE_STRIP,2*this.n,gl.UNSIGNED_SHORT,0)};USegment.prototype.clear=function(){gl.deleteBuffer(this.vbuf)};UTgs.prototype.SetColor=function(a){var b=this.color;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3]};UTgs.prototype.updateData=function(){gl.bindBuffer(gl.ARRAY_BUFFER,this.vbuf);gl.bufferSubData(gl.ARRAY_BUFFER,0,this.vrt);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.ibuf);gl.bufferSubData(gl.ELEMENT_ARRAY_BUFFER,0,this.ind);gl.bindBuffer(gl.ARRAY_BUFFER,this.tbuf);gl.bufferSubData(gl.ARRAY_BUFFER,0,this.uvt)};UTgs.prototype.render=function(a){if(this.useTex){if(this._bdata._loaded==false)return;gl.uniform1i(a._sprg.useTex,1);gl.bindTexture(gl.TEXTURE_2D,this._bdata._texture);gl.uniform1i(a._sprg.samplerUniform,0)}else{gl.uniform1i(a._sprg.useTex,0);gl.uniform4fv(a._sprg.color,this.color)}gl.bindBuffer(gl.ARRAY_BUFFER,this.tbuf);gl.vertexAttribPointer(a._sprg.tca,2,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,this.vbuf);gl.vertexAttribPointer(a._sprg.vpa,2,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.ibuf);gl.drawElements(gl.TRIANGLES,this.ind.length,gl.UNSIGNED_SHORT,0)};UTgs.prototype.clear=function(){gl.deleteBuffer(this.vbuf);gl.deleteBuffer(this.ibuf);gl.deleteBuffer(this.tbuf)};FillStyle.prototype.Set=function(a,b){var c=this.color;c[0]=(a>>16&255)*.0039215686;c[1]=(a>>8&255)*.0039215686;c[2]=(a&255)*.0039215686;c[3]=b};LineStyle.prototype=new FillStyle;LineStyle.prototype.Set=function(a,b,c){this.thickness=a;FillStyle.prototype.Set.call(this,b,c)};Sprite.prototype=new DisplayObjectContainer;Sprite.prototype._render=function(a){if(!this.graphics._empty)this.graphics._render(a);DisplayObjectContainer.prototype._render.call(this,a)};Sprite.prototype._moveMouse=function(a,b,c){var d=DisplayObjectContainer.prototype._moveMouse.call(this,a,b,c);if(d!=null)return d;if(c)if(this.visible&&this.mouseEnabled&&this.graphics._hits(this.mouseX,this.mouseY))return this;return null};Sprite.prototype._getRect=function(){var a=DisplayObjectContainer.prototype._getRect.call(this);var b=this.graphics._getRect();if(a!=null&&b!=null)return a.union(b);else if(a==null)return b;else return a};var TextFormatAlign={LEFT:"left",CENTER:"center",RIGHT:"right",JUSTIFY:"justify"};TextFormat.prototype.clone=function(){return new TextFormat(this.font,this.size,this.color,this.bold,this.italic,this.align,this.leading)};TextFormat.prototype.set=function(a){this.font=a.font;this.size=a.size;this.color=a.color;this.bold=a.bold;this.italic=a.italic;this.align=a.align;this.leading=a.leading};TextFormat.prototype.getImageData=function(a,b){var c=this.color;var d=c>>16&255;var e=c>>8&255;var f=c&255;var g="rgb("+d+","+e+","+f+")";var h=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.size+"px "+this.font;var i=TextFormat._canvas;var j=TextFormat._context;this.data.image=i;i.width=this._nhpt(b._areaW);i.height=this._nhpt(b._areaH);j.textBaseline="top";j.fillStyle=g;j.font=h;this.maxW=0;var k=a.split("\n");var l=0;var m=0;var n=this.size*1.25;for(var o=0;o<k.length;o++){var p=this.renderPar(k[o],m,n,j,b);l+=p;m+=p*(n+this.leading)}if(this.align==TextFormatAlign.JUSTIFY)this.maxW=Math.max(this.maxW,b._areaW);this.data.tw=this.maxW;this.data.th=(n+this.leading)*l-this.leading;return this.data};TextFormat.prototype.renderPar=function(a,b,c,d,e){var f;if(e.wordWrap)f=a.split(" ");else f=[a];var g=d.measureText(" ").width;var h=0;var i=e._areaW;var j=0;var k=[[]];var l=[];for(var m=0;m<f.length;m++){var n=f[m];var o=d.measureText(n).width;if(h+o<=i||h==0){k[j].push(n);h+=o+g}else{l.push(i-h+g);k.push([]);j++;h=0;m--}}l.push(i-h+g);for(var m=0;m<k.length;m++){var p=k[m];while(p[p.length-1]==""){p.pop();l[m]+=g}this.maxW=Math.max(this.maxW,i-l[m]);var q,r=b+(c+this.leading)*m;h=0,q=g;if(this.align==TextFormatAlign.CENTER)h=l[m]*.5;if(this.align==TextFormatAlign.RIGHT)h=l[m];if(this.align==TextFormatAlign.JUSTIFY)q=g+l[m]/(p.length-1);for(var s=0;s<p.length;s++){var n=p[s];d.fillText(n,h,r);var o=d.measureText(n).width;if(m<k.length-1)h+=o+q;else{h+=o+g}}}return j+1};TextFormat.prototype._nhpt=function(a){--a;for(var b=1;b<32;b<<=1)a=a|a>>b;return a+1};TextFormat._canvas=document.createElement("canvas");TextFormat._context=TextFormat._canvas.getContext("2d");TextField.prototype=new InteractiveObject;TextField.prototype.setTextFormat=function(a){this._tForm.set(a);this.setText(this._text)};TextField.prototype.getTextFormat=function(a){return this._tForm.clone()};TextField.prototype.setArea=function(a,b){this._areaW=a;this._areaH=b;this.setText(this._text)};TextField.prototype.setText=function(a){if(a==null)return;this._text=a.toString();var b=this._tForm.getImageData(this._text,this);this.textWidth=b.tw;this.textHeight=b.th;var c=this._brect.width=this._areaW;var d=this._brect.height=this._areaH;gl.bindTexture(gl.TEXTURE_2D,this._texture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,b.image);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR_MIPMAP_NEAREST);gl.generateMipmap(gl.TEXTURE_2D);var e=c/b.image.width;var f=d/b.image.height;var g=this._tcArray;g[2]=g[6]=e;g[5]=g[7]=f;gl.bindBuffer(gl.ARRAY_BUFFER,this._tcBuffer);gl.bufferSubData(gl.ARRAY_BUFFER,0,g);var h=this._fArray;h[2]=h[6]=c;h[5]=h[7]=d;gl.bindBuffer(gl.ARRAY_BUFFER,this._vBuffer);gl.bufferSubData(gl.ARRAY_BUFFER,0,h)};TextField.prototype._render=function(a){gl.uniformMatrix3fv(a._sprg.tMatUniform,false,a._mstack.top());gl.bindBuffer(gl.ARRAY_BUFFER,this._vBuffer);gl.vertexAttribPointer(a._sprg.vpa,2,gl.FLOAT,false,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,this._tcBuffer);gl.vertexAttribPointer(a._sprg.tca,2,gl.FLOAT,false,0,0);gl.bindTexture(gl.TEXTURE_2D,this._texture);gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0)};Resizable.prototype=new Sprite;Resizable.prototype.resize=function(a,b){this.w=a;this.h=b};MainMenu.prototype=new Resizable;MainMenu.prototype.GoPlay=function(){this.dispatchEvent(new Event("GoPlay",true))};LevelSelect.prototype=new Resizable;LevelSelect.prototype.LevelDone=function(a){};LevelSelect.prototype.GoBack=function(a){this.dispatchEvent(new Event("GoBack",true))};LevelSelect.prototype.LevelChosen=function(a){this.dispatchEvent(new Event("LevelChosen",true))};GameControl.prototype=new Resizable;GameControl.prototype.GameDone=function(a){this.dispatchEvent(new Event("GameDone",true))};GameControl.prototype.Restart=function(a){this.dispatchEvent(new Event("Restart",true))};GameControl.prototype.ExitGame=function(a){this.dispatchEvent(new Event("ExitGame",true))};Main.prototype=new Resizable;Main.prototype.resize=function(a,b){Resizable.prototype.resize.call(this,a,b);if(this.mm)this.mm.resize(a,b);if(this.ls)this.ls.resize(a,b);if(this.gc)this.gc.resize(a,b)};Main.GoPlay=function(a){var b=a.target;b.removeChild(b.mm);b.addChild(b.ls)};Main.GoBack=function(a){var b=a.target;b.removeChild(b.ls);b.addChild(b.mm)};Main.LevelChosen=function(a){var b=a.target;b.removeChild(b.ls);b.addChild(b.gc);b.gc.StartLevel(b.ls.levelData)};Main.GameDone=function(a){var b=a.target;b.removeChild(b.gc);b.addChild(b.ls);b.ls.LevelDone(b.gc.result)};Main.ExitGame=function(a){var b=a.target;b.removeChild(b.gc);
b.addChild(b.ls)}